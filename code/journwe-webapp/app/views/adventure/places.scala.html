@(adv: models.adventure.Adventure)

@import models.dao.PlaceOptionDAO

<script src="https://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyAbYnwpdOgqWhspiETgFdlXyX3H2Fjb8fY"></script>
<script>

    var map;
    google.maps.visualRefresh = true;

    function initialize() {
    var mapOptions = {
    zoom: 19,
    center: new google.maps.LatLng(52.467541, 13.324957),
    mapTypeId: google.maps.MapTypeId.SATELLITE
    };
    map = new google.maps.Map(document.getElementById('where-map'),
    mapOptions);
    }

    google.maps.event.addDomListener(window, 'load', initialize);


    var markers = [];

    function searchPlace() {
    new google.maps.Geocoder().geocode({'address': $('#place-add-input').val()}, function (results, status) {
    var id = 'places-item-' + results[0].geometry.location.lat().toString().replace('.', '_') + '-' + results[0].geometry.location.lng().toString().replace('.', '_');
    $('#places-list').append('<li id="' + id +'"><input type="hidden" name="place[]" value="' + results[0].formatted_address + '"><span class="label"><i class="icon-map-marker"></i>' + results[0].formatted_address + ' &nbsp;<a href="#" onclick="$(\'#' + id + '\').remove(); removeMarker(\'' + id + '\')">&times;</a></span> <span class="divider"></span></li>');
    map.setCenter(results[0].geometry.location);
    var marker = new google.maps.Marker({
    map: map,
    position: results[0].geometry.location
    });
    markers[id] = marker;

    resetBounds();
    $('#place-add-input').val('');
    });
    }

    function resetBounds() {
    var bounds = new google.maps.LatLngBounds();
    for(var i in markers) {
    bounds.extend(markers[i].getPosition());
    }
    map.fitBounds(bounds);
    google.maps.event.trigger(map, 'resize');
    }

    function removeMarker(id) {
    markers[id].setMap(null);
    delete markers[id];
    resetBounds();
    }

</script>


<ul id="places-list" class="unstyled inline">
</ul>

<table class="table table-striped table-hover table-places">
    <thead>
        <tr>
            <th>Place Options</th>
            <th>Location</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    @{new PlaceOptionDAO()}.all(adv.getId()).map {
            placeOption =>
            <tr data-id="@placeOption.getId()">
                <td>@placeOption.getName()</td>
                <td>@placeOption.getGoogleMapsAddress()</td>
                <td><a href="#" class="btn btn-alert"><i class="icon-trash"></i></a></td>
            </tr>
            <script>
            <![CDATA[
                new google.maps.Geocoder().geocode({address: '@placeOption.getGoogleMapsAddress()'}, function (results, status) {
                    var marker = new google.maps.Marker({map: map,
                        position: results[0].geometry.location});
                    markers[] = marker;
                    });
            ]]>
            </script>
        }

    </tbody>
</table>

<div class="input-append">
    <input type="text" placeholder="A decent place name" id="place-add-input">
    <a id="place-add-button" class="btn btn-add"><i class="icon-plus"></i></a>
</div>

<div style="height: 400px;">
    <div id="where-map" style="width: 100%; height: 100%"></div>
</div>

<script>
    $('#place-add-button')
    .on('click', function() {

        new google.maps.Geocoder().geocode({'address': $('#place-add-input').val()}, function (results, status) {
            $.post('@routes.AdventureController.addPlace(adv.getId)', { name: results[0].formatted_address, googleMapsAddress: results[0].formatted_address },
                function(res) {
                    $('.table-places  tbody').append($('<tr class="place-entry" data-id="' + res.id + '">  <td><input class="input-status" type="checkbox"/></td>   <td>' + res.name + '</td> <td>' + res.googleMapAddress + '</td>  <td><a href="#" class="btn-delete"><i class="icon-trash"></i>Delete</a></td> </tr>').fadeIn());

                    $('#place-add-input').val("");
                });
            });
    });

</script>

