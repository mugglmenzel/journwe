@(adv: models.adventure.Adventure)



<table id="places-list" class="table table-striped table-hover table-my-todos">
    <thead>
        <tr>
            <th>Place Options</th>
            <th>Location</th>
            <th></th>
        </tr>
    </thead>

    <tbody>

    </tbody>

</table>

<div class="input-append">
    <input type="text" placeholder="A decent place name" id="place-add-input">
    <a id="place-add-button" class="btn btn-add"><i class="icon-plus"></i></a>
</div>

<div style="height: 400px;">
    <div id="where-map" style="width: 100%; height: 100%"></div>
</div>

<script type="text/x-tmpl" id="place-template">
    <tr>
        <td><input class="input-status" type="checkbox"/></td>
        <td>{%=o.name%}</td>
        <td>{%=o.googleMapsAddress%}</td>
        <td><a href="#" class="btn btn-danger"><i class="icon-trash"></i></a></td>
        {%

        $('body').ready(function(){
        new google.maps.Geocoder().geocode({address: o.googleMapsAddress}, function (results, status) {
        var marker = new google.maps.Marker({map: map,
        position: results[0].geometry.location});
        markers[o.id] = marker;
        map.setCenter(results[0].geometry.location);
        resetBounds();
        });
        });

        %}
    </tr>
</script>


<script src="https://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyAbYnwpdOgqWhspiETgFdlXyX3H2Fjb8fY"></script>
<script>

    var map;
    var markers = [];
    google.maps.visualRefresh = true;

    function initialize() {
    var mapOptions = {
    zoom: 19,
    center: new google.maps.LatLng(52.467541, 13.324957),
    mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById('where-map'),
    mapOptions);

    }


    function resetBounds() {
    var bounds = new google.maps.LatLngBounds();
    for(var i in markers) {
    bounds.extend(markers[i].getPosition());
    }
    map.fitBounds(bounds);
    google.maps.event.trigger(map, 'resize');
    }

    function removeMarker(id) {
    markers[id].setMap(null);
    delete markers[id];
    resetBounds();
    }

    $('#place-add-button')
    .on('click', function() {

    new google.maps.Geocoder().geocode({'address': $('#place-add-input').val()}, function (results, status) {
    $.post('@routes.AdventurePlaceController.addPlace(adv.getId)', { name: 'Option ' + ($('#places-list tbody').children().length+1), googleMapsAddress: results[0].formatted_address },
    function(res) {
    $('#places-list tbody').append(tmpl('place-template', res));
    $('#place-add-input').val("");
    });
    });
    });

    $('body').ready(function (){initialize();});
    $('#places-list').ready(
    function (){
    $.get('@routes.AdventurePlaceController.getPlaces(adv.getId)', function (places) {
    $('#places-list tbody').empty();
    for(var id in places) {
    $('#places-list tbody').append(tmpl('place-template', places[id]));
    }

    });
    });

</script>



