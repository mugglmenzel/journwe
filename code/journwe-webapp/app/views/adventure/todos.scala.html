@(adv: models.adventure.Adventure, advr: models.adventure.adventurer.Adventurer)

@import models.authorization.JournweAuthorization
@import models.dao.adventure.TodoDAO
@import models.dao.user.UserDAO
@import models.dao.adventure.AdventurerDAO
@import models.adventure.todo.EStatus
@import models.adventure.adventurer.EAdventurerParticipation

@defining(new JournweAuthorization(adv.getId)){ auth =>

    @if(auth.canViewTodoItem()) {
    <table id="todos-list" class="table table-striped table-hover table-my-todos">
        <thead>
        <tr>
            <th colspan="2">@Messages("adventure.todos.listheading")</th>
            <th></th>
            <th class="text-center">@Messages("adventure.general.listactions")</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    }

    @if(auth.canEditTodoItem()) {
    <div class="row">
        <div class="input-group col-lg-6">
            <input id="todo-title" type="text" placeholder="@Messages("adventure.todos.placeholder")" class="form-control"/>
            <div class="input-group-btn">
                <button id="btn-add-todo" class="btn btn-primary" type="button"><i class="fa fa-plus"></i></button>
            </div>
        </div>
    </div>
    }

    <div class="spacer30"></div>
    <h3>@Messages("adventure.todos.otherAdventurer")</h3>

    <div id="todos-adventurers-selection" style="overflow: hidden;">
    @defining(new AdventurerDAO()){ advrDAO =>
        @advrDAO.all(adv.getId()).filter(advr => !(advr.getParticipationStatus().equals(EAdventurerParticipation.APPLICANT) && advr.getParticipationStatus().equals(EAdventurerParticipation.INVITEE))).filter(!_.getUserId.equals(advr.getUserId)).zipWithIndex.map{ case(coadvr, idx) =>
            @defining(new UserDAO().get(coadvr.getUserId())) { user =>
                    @if(user != null){
                        <div id="todos-adventurer-@user.getId" data-id="@user.getId" class="polaroid polaroid-hover" style="position: relative; float: left; margin-right: 20px; margin-bottom: 20px;">
                            <a class="todos-adventurer">
                                <img style="margin: 0px;" title="@user.getName" @if(user.getImage() == null) {src="http://www.placehold.it/100x100/EFEFEF/AAAAAA&text=no+image"} else {src="http://i.embed.ly/1/image/crop?width=100&height=100&url=@user.getImage()&key=2c8ef5b200c6468f9f863bc75c46009f"}>

                                <div style="background-color: rgba(255,255,255,0.6); position: absolute; bottom: 0px; left: 0px; right: 0px; padding: 5px 10px !important;">
                                    <div style="line-height: 10px;">@if(user.getName){@user.getName().replaceAll(" [^ ]*$", "")}else{Unknown}</div>
                                </div>
                            </a>
                        </div>
                    }
            }
        }
    }
    </div>

    <table id="todos-adventurers-list" class="table table-striped table-hover stash">
        <thead>
        <tr>
            <th colspan="2">@Messages("adventure.todos.listheading")</th>
            <th></th>
            <th class="text-center">@Messages("adventure.general.listactions")</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>


    <div id="amazon-affiliate" class="modal fade" tabindex="-1" role="dialog" style="color: black">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 class="modal-title"> @Messages("adventure.todos.amazon.title") </h3>
                </div>
                <div class="modal-body"><div><i class="icon-journwe fa fa-spin"></i></div><div class="content"></div></div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal"><i class="fa fa-remove"></i> @Messages("adventure.general.button.close")</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/x-tmpl" id="todo-template">
        <tr class="status-{%=o.status%} todo-entry" data-id="{%=o.todoId%}">
            <td><button class="btn btn-primary btn-check"><i class="fa fa{% if(o.status == '@EStatus.COMPLETE'){ %}{%=String('-check')%}{% } %}-square-o"></i></button></td>
            <td style="width:100%;">{%=o.title%}</td>
            <td><a class="btn btn-link btn-affiliate"> @Messages("adventure.todos.amazon.purchase") </a></td>
            @if(auth.canEditTodoItem()) {
            <td class="text-center"><button class="btn btn-danger btn-delete"><i class="fa fa-trash-o"></i></button></td>
            }
        </tr>
    </script>
    <script type="text/x-tmpl" id="todo-adventurer-template">
        <tr class="status-{%=o.status%} todo-entry" data-id="{%=o.todoId%}">
            <td><i class="fa fa-{% if(o.status == '@EStatus.COMPLETE'){ %}{%=String('-check')%}{% } %}-square-o"></i></td>
            <td style="width:100%;">{%=o.title%}</td>
            <td><a class="btn btn-link btn-affiliate"> @Messages("adventure.todos.amazon.purchase") </a></td>
            <td class="text-center"><button class="btn btn-primary btn-copy" title="Copy todo to my list."><i class="fa fa-plus"></i></button></td>
        </tr>
    </script>
    <script type="text/x-tmpl" id="todo-affiliate-template">
        <div class="media" style="max-height: 200px">
            <a class="pull-left" href="{%=o.url%}" target="_blank">
                <img class="media-object" src="{%=o.image%}" alt="{%=o.title%} thumbnail" style="width: 100px;">
            </a>
            <div class="media-body">
                <h4 class="media-heading"><a class="pull-left" href="{%=o.url%}" target="_blank">{%=o.title%}</a> {%=o.price%}</h4>
                {%=o.description%} <a href="{%=o.url%}" target="_blank"> @Messages("adventure.general.button.more") </a>
            </div>
        </div>
    </script>

}
