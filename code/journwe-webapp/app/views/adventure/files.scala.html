@(adv: models.adventure.Adventure, fileForm: Form[models.adventure.file.JournweFile])

@import models.adventure.file.JournweFile

@import helper._
@import fieldConstructor._

@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.render) }

<div class="times-loading"><i class="icon-spin icon-spinner"></i> Loading</div>

    <table id="files-list" class="table table-striped table-hover hide">
        <thead>
            <tr>
                <th>File name</th>
                <th>Uploaded by</th>
                <th>Download URL</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

@form(routes.AdventureFileController.uploadFile(adv.getId()), args = 'class -> "form-horizontal",  'enctype -> "multipart/form-data") {
    <fieldset>
        @inputText(fileForm("fileName"), '_label -> "File name", 'required -> "required")
        @inputText(fileForm("fileDescription"), '_label -> "Description")
        @inputFile(fileForm("uploadFile"), '_label -> "File")(FieldConstructor(twitterBootstrapInputFileUpload.render), Lang.apply("en-US"))
    </fieldset>
    <div class="form-actions">
        <input type="submit" value="Upload File" class="btn btn-primary"> | <a href="@routes.ApplicationController.index()" class="btn btn-link">Cancel</a>
    </div>
}

<script>

    $('#files-list').ready(function (){
    $.get('@routes.AdventureFileController.listFiles(adv.getId)', function (files) {
    $('#files-list tbody').empty();
    for(var fileName in files) {
    renderFile(files[fileName])
    }
    if (files.length){
    $('#files-list').show();
    } else {
    $('#files-list').hide();
    }

    $('.files-loading').hide();
    });
    });

    function renderFile(data, replace) {
    if(replace)
    replace.replaceWith(tmpl('files-template', data)).fadeIn();
    else
    $('#files-list tbody').append(tmpl('files-template', data));

    }

    function deleteFile(fileName, el) {
    $(el).html('<i class="icon-spin icon-spinner"></i>');
    $.ajax({url: '@routes.AdventureFileController.deleteFile(adv.getId(), "")' + fileId, type: 'DELETE', success: function () {
    $('#files-item-' + fileName).fadeOut(function () {$('#files-item-' + fileId).remove();});
    }
    });
    }

</script>