@(adv: models.adventure.Adventure)

@import models.authorization.JournweAuthorization
@import models.adventure.file.JournweFile

@import helper._
@import fieldConstructor._

@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.render) }

    <script type="text/x-tmpl" id="emails-template">
        <tr>
            <td><span class="label label-info" title="{%=o.sender%}">{%=o.sender%}</span></td>
            <td>{%=o.subject%}</td>
            <td>{%=o.timestamp%}</td>
        </tr>
    </script>


 <!--
    <div class="row">
        <div class="pull-left files-loading stash"><i class="fa fa-spin icon-journwe"></i> @Messages("adventure.general.loading")</div>
    </div>
-->

    <table id="emails-list" class="table table-striped table-hover table-condensed stash">
        <thead>
            <tr>
                <th>Sender</th>
                <th>Subject</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>





<script type="text/javascript">
    $(document).ready(function (){
        loadEmails();

        $('#emails-button-refresh' ).click(function (){loadEmails();});

    });



    function loadEmails() {
        //$('.files-loading').show();
        $('#emails-button-refresh i').addClass("fa fa-spin");

        $.get('@routes.AdventureEmailController.listEmails(adv.getId)', function (emails) {
            $('#emails-list tbody').empty();

            for (var i in emails) {
                renderEmail(emails[i]);
            }
            if (emails.length){
                $('#emails-list').show();
            } else {
                $('#emails-list').hide();
            }

            //$('.files-loading').hide();
            $('#emails-button-refresh i').removeClass("fa fa-spin");
        });
    }


    function renderEmail(data, replace) {
        if(replace)
            replace.replaceWith(tmpl('emails-template', data)).fadeIn();
        else
            $('#emails-list tbody').append(tmpl('emails-template', data));

    }

</script>