@(categories: List[models.helpers.CategoryCount])

<div id="yingyangyong-click-info" class="row-fluid">
    <div class="span2 offset1 text-center">
        <i class="icon-chevron-down"></i>
        click on <img src='@routes.Assets.at("img/yingyangyong_green.png")' style="height: 20px;">
    </div>
</div>
<form id="yingyangyong-form" action="@routes.AdventureController.save()" method="POST" onsubmit="return validateYingYangYong();">
    <div class="row-fluid">
        <div class="span2 offset1 text-center">
            <a href="#" onclick="switchMode(); $('#yingyangyong-click-info').fadeOut();"><img id="yingyangyong" src='@routes.Assets.at("img/yingyangyong_green.png")' class="where"></a>
        </div>
            <!--<a href="@routes.AdventureController.create()" class="btn btn-primary btn-large text-center">Start
            a new Group Adventure!</a> -->
        <div class="span8" style="min-height: 650px; position: relative;">
            <div class="input-append">
                <input type="text" name="name" placeholder="Name your JournWe" required="required" class="input input-xxl">


                <div class="btn-group">
                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                        Choose Category
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                    @for(cat <- categories) {
                        <li><a><span
                        class="badge badge-info pull-right">@cat.getCount()</span> @cat.getCategory().getName()
                        </a>
                        </li>
                    }
                    </ul>
                </div>
            </div>
            <div class="pull-right">
                <button style="backround-color: #00cc00;" class="btn btn-large" onclick="">
                    Start JournWe <i class="icon-angle-right"></i></button>
            </div>
            <div>
                <div class="input-append">
                    <input type="text" name="shortname" placeholder="Shortname" id="shortname" minlength="3" required="required" onchange="checkShortname();">
                    <span class="add-on">@@adventure.journwe.com</span>
                    <a class="add-on btn" onclick="checkShortname();">check</a>
                </div>
                <div id="shortname-available">shortname available?</div>
            </div>


            <div id="where-dialog" style="border: solid 0px #78a942; border-radius: 5px; background-color: #78a942; margin-bottom: 20px">
                <div style="background-color: rgba(255, 255, 255, 0.3); padding: 15px; ">
                    <h1><i class="icon-globe"></i> Where do you want to go?</h1>

                    <ul id="places-list" class="unstyled inline">
                    </ul>

                    <div class="input-append">
                        <input type="text" placeholder="A decent place name" id="place-add-input" onkeypress="if (event.which == 13 || event.keyCode == 13) {searchPlace(); event.preventDefault(); return false;} else return true;">
                        <a class="btn btn-add" onclick="searchPlace();"><i class="icon-plus"></i></a>
                    </div>
                    <div style="height: 400px;">
                        <div id="where-map" style="width: 100%; height: 100%"></div>
                    </div>
                </div>
            </div>

            <div id="who-dialog" style="border: solid 0px #eb3d00; border-radius: 5px; background-color: #eb3d00; margin-bottom: 20px; display: none;">
                <div style="background-color: rgba(255, 255, 255, 0.2); padding: 15px; ">
                    <h1><i class="icon-group"></i> Who's gonna join your JournWe?</h1>

                    <ul id="people-list" class="unstyled inline"></ul>

                    <div class="input-append input-prepend">
                        <div class="btn-group">
                            <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                                <i id="people-add-type" class="icon-facebook"></i>
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="#" onclick="$('#people-add-type').attr('class', 'icon-facebook'); $('#people-add-input').attr('type', 'text'); $('#people-add-input').focus();"><i class="icon-facebook"></i>
                                    Facebook</a></li>
                                <li><a href="#" onclick="$('#people-add-type').attr('class', 'icon-envelope'); $('#people-add-input').attr('type', 'email'); $('#people-add-input').focus();"><i class="icon-envelope"></i>
                                    Email</a></li>
                            </ul>
                        </div>
                        <input id="people-add-input" type="text" placeholder="A good ol' friend" onkeypress="if (event.which == 13 || event.keyCode === 13) {addFriend(); event.preventDefault(); return false;} else return true;">
                        <a class="btn btn-add" onclick="addFriend();"><i class="icon-plus"></i></a>
                    </div>
                    <div class="spacer20"></div>
                    <div>Is your Adventure public? &nbsp;
                        <div class="switch"><input type="checkbox" id="publish" name="publish" value="true"></div>
                    </div>
                </div>
            </div>

            <div id="when-dialog" style="border: solid 0px #00d1fb; border-radius: 5px; background-color: #00d1fb; margin-bottom: 20px; display: none;">
                <div style="background-color: rgba(255, 255, 255, 0.5); padding: 15px; ">
                    <h1><i class="icon-calendar"></i> When do you want to set off?</h1>

                    <ul id="time-list" class="unstyled inline"></ul>

                    <div class="form-inline">


                        <div class="input-prepend">
                            <span class="add-on">Start Date</span>
                            <input id="time-add-input-start" type="date" name="startDate" placeholder="Start Date" style="max-width: 150px;"/>
                        </div>
                        <div class="input-prepend">
                            <span class="add-on">End Date</span>
                            <input id="time-add-input-end" type="date" name="endDate" placeholder="End Date" style="max-width: 150px;"/>
                        </div>

                        <a class="btn btn-add" onclick="addTime();"><i class="icon-plus"></i></a>

                    </div>

                </div>
            </div>
        </div>

    </div>
</form>

<script src="https://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyAbYnwpdOgqWhspiETgFdlXyX3H2Fjb8fY"></script>
<script>

    function switchMode() {
        var icon = $('#yingyangyong');
        if (icon.is('.where')){
        icon.removeClass('where').addClass('who');
        showDialog('who-dialog');
        } else if(icon.is('.who')){
        icon.removeClass('who').addClass('when');
        showDialog('when-dialog');
        } else if (icon.is('.when')){
        icon.removeClass('when').addClass('where');
        showDialog('where-dialog');
        }
    };

    function showDialog(dialog) {
        var dialogs = {
            'where-dialog' : 'when-dialog',
            'when-dialog': 'who-dialog',
            'who-dialog': 'where-dialog'
            };
        $('#' + dialogs[dialog]).fadeOut(500, function () {});
        $('#' + dialog).fadeIn(500);
    }

    function checkShortname() {
        $.post('@routes.AdventureController.checkShortname()', { value : $('#shortname').val() },
            function(check) {
                $('#shortname-available').html(check.valid ? '<span class="text-success"><i class="icon-ok"></i> available.</span>' : '<span class="text-error"><i class="icon-warning-sign"></i> not available!</span>' );
                $('#shortname').attr('aria-invalid', !check.valid);
                if(!check.valid)
                    $('#shortname').parents(".control-group").first().addClass('error');
                else
                    $('#shortname').parents(".control-group").first().removeClass('error');
        });
    }

        function validateYingYangYong() {
            if($('input[name="name"]').val() == null ||  $('input[name="name"]').val() == '') {
                $('input[name="name"]').focus();
                return false;
            }
            if($('input[name="shortname"]').val() == null ||  $('input[name="shortname"]').val() == '') {
                $('input[name="shortname"]').focus();
                return false;
            }

            return true;
        }



    var map;
    google.maps.visualRefresh = true;

    function initialize() {
        var mapOptions = {
            zoom: 15,
            center: new google.maps.LatLng(49.483472, 8.476992),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('where-map'),
        mapOptions);

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    map.setCenter(pos);
                }, function() {});
        }

    }

    google.maps.event.addDomListener(window, 'load', initialize);


    var markers = [];

    function searchPlace() {
        new google.maps.Geocoder().geocode({'address': $('#place-add-input').val()}, function (results, status) {
            var id = 'places-item-' + results[0].geometry.location.lat().toString().replace('.', '_') + '-' + results[0].geometry.location.lng().toString().replace('.', '_');
            $('#places-list').append('<li id="' + id +'"><input type="hidden" name="place[]" value="' + results[0].formatted_address + '"><span class="label"><i class="icon-map-marker"></i>' + results[0].formatted_address + ' &nbsp;<a href="#" onclick="$(\'#' + id + '\').remove(); removeMarker(\'' + id + '\')">&times;</a></span> <span class="divider"></span></li>');
            map.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
            });
            markers[id] = marker;

            resetBounds();
            $('#place-add-input').val('');
        });
    }

    function resetBounds() {
        var bounds = new google.maps.LatLngBounds();
        for(var i in markers) {
        bounds.extend(markers[i].getPosition());
        }
        map.fitBounds(bounds);
        google.maps.event.trigger(map, 'resize');
    }

    function removeMarker(id) {
        markers[id].setMap(null);
        delete markers[id];
        resetBounds();
    }

    var peopleCounter = 0;
    function addFriend() {
        var id = 'people-item-' + peopleCounter++;
        var input = ($('#people-add-input').attr('type') == 'text') ? '<input type="hidden" name="facebook[]" value="' + $('#people-add-input').val() + '">' : '<input type="hidden" name="email[]" value="' + $('#people-add-input').val() + '">';
        $('#people-list').append('<li id="' + id +'">' + input + '<span class="label"><i class="' + $('#people-add-type').attr('class') + '"></i>' + $('#people-add-input').val() + ' &nbsp;<a href="#" onclick="$(\'#' + id + '\').remove();">&times;</a></span> <span class="divider"></span></li>');
        $('#people-add-input').val('');
    }


    $('#time-add-input-start').ready(function () {$('#time-add-input-start').attr('min', new Date().toJSON().slice(0,10));});

    function addTime() {
        var id = 'time-item-' + $('#time-add-input-start').val() + '-' +  $('#time-add-input-end').val();
        $('#time-list').append('<li id="' + id +'"><input type="hidden" name="time[]" value="' + $('#time-add-input-start').val() + ',' + $('#time-add-input-end').val() + '"><span class="label"><i class="icon-time"></i>' + $('#time-add-input-start').val() + ' to ' + $('#time-add-input-end').val() + ' &nbsp;<a href="#" onclick="$(\'#' + id + '\').remove();">&times;</a></span> <span class="divider"></span></li>');
        $('#time-add-input-start').val('');
        $('#time-add-input-end').val('');
    }

</script>
