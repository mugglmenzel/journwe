@(inspForm: Form[Inspiration])(categories: Map[String, String])(inspirations: List[Inspiration])

@import helper._
@import fieldConstructor._

@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.render) } 

@main("Manage Inspirations"){Manage Inspirations} {
  
	
  
	<h2>Inspirations</h2>
	<table class="table table-striped">
		
	@for(ins <- inspirations) {
		<tr><td>@ins.getInspirationId()</td><td>@ins.getName()</td><td><a href="@routes.InspirationController.edit(ins.getCategoryId, ins.getInspirationId())" class="act-primary"><i class="icon-edit"></i>edit</a></td><td><a href="@routes.InspirationController.delete(ins.getCategoryId, ins.getInspirationId())" class="act-danger"><i class="icon-trash"></i>delete</a></td></tr>
	}
	</table>

	<h2>Inspiration Form</h2>
    @form(routes.InspirationController.save(), 'class -> "form-horizontal", 'enctype -> "multipart/form-data") {
    	<fieldset>
    		@if(inspForm("inspirationId").value()) {
    		<input type="hidden" name="originalInspirationCategoryId" value="@inspForm("categoryId").value()"/>
    		<input type="hidden" name="@inspForm("inspirationId").name()" value="@inspForm("inspirationId").value()"/>
    		}
            @inputText(inspForm("name"), '_label -> "Inspiration name", 'placeholder -> "Name", 'required -> "")
            @textarea(inspForm("description"), '_label -> "Description", 'placeholder -> "Some text", 'class -> "editor editor-html ckeditor")
    		@inputFile(inspForm("image"), '_label -> "Image")(FieldConstructor(twitterBootstrapInputImgUpload.render), Lang.apply("en-US"))
            @textarea(inspForm("tripAdvisor"), '_label -> "TripAdvisor Snipped (see http://www.tripadvisor.com/Widgets)", 'placeholder -> "Some text")
            @inputText(inspForm("pinterest"), '_label -> "Pinterest URL", 'placeholder -> "Pinterest")
            @inputText(inspForm("weatherId"), '_label -> "Weather", 'placeholder -> "Country/City")
    		@select(
    			inspForm("categoryId"),
    			options(categories), 
    			'_default -> "--- Choose a Category ---",
    			'_label -> "Category",
    			'_error -> inspForm("categoryId").error.map(_.withMessage("Please select a Category!"))
    		)

            <div>
                <div>Place</div>
                <ul id="inspiration-place" class="list-unstyled list-inline">
                </ul>

                <div class="input-group">
                    <input type="text" placeholder="A decent place name" id="inspiration-place-input" onkeypress="if (event.which == 13 || event.keyCode == 13) {searchPlace(); event.preventDefault(); return false;} else return true;" class="form-control">
                    <div class="input-group-btn"><a class="btn btn-primary btn-add" onclick="searchPlace();"><i class="icon-plus"></i></a></div>
                </div>
                <div style="height: 400px; margin-top: 10px;">
                    <div id="inspiration-place-map" style="width: 100%; height: 100%"></div>
                </div>
                <script src="https://maps.googleapis.com/maps/api/js?sensor=false&key=AIzaSyAbYnwpdOgqWhspiETgFdlXyX3H2Fjb8fY"></script>
                <script>
                var map;
                google.maps.visualRefresh = true;

                function initialize() {
                    var mapOptions = {
                        zoom: 15,
                        center: new google.maps.LatLng(49.483472, 8.476992),
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    map = new google.maps.Map(document.getElementById('inspiration-place-map'), mapOptions);

                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                            var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                            map.setCenter(pos);
                        }, function() {});
                    }

                }

                google.maps.event.addDomListener(window, 'load', initialize);


                var markers = [];

                function searchPlace() {
                    new google.maps.Geocoder().geocode({'address': $('#inspiration-place-input').val()}, function (results, status) {
                        var id = 'inspiration-place';
                        $('#inspiration-place').html('<li id="' + id +'"><input type="hidden" name="place" value="' + results[0].formatted_address + '|' + results[0].geometry.location.lat().toString() + '|' + results[0].geometry.location.lng().toString() + '"><span class="label"><i class="icon-map-marker"></i> ' + results[0].formatted_address + ' &nbsp;<a href="#" onclick="$(\'#' + id + '\').remove(); removeMarker(\'' + id + '\'); return false;">&times;</a></span> <span class="divider"></span></li>');
                        map.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location
                        });
                        markers[id] = marker;

                        resetBounds();
                        $('#inspiration-place-input').val('');
                    });
                }

                function resetBounds() {
                    var bounds = new google.maps.LatLngBounds();
                    for(var i in markers) {
                        bounds.extend(markers[i].getPosition());
                    }
                    map.fitBounds(bounds);
                    google.maps.event.trigger(map, 'resize');
                }

                function removeMarker(id) {
                    markers[id].setMap(null);
                    delete markers[id];
                    resetBounds();
                    return false;
                }
                </script>
            </div>
 
    	</fieldset>
    	<div class="form-actions">
    	  <input type="submit" value="Save Inspiration!" class="btn btn-primary"> | <a href="@routes.ApplicationController.index()" class="btn btn-link">Cancel</a>
    	</div>
    }
    
}
